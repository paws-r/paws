#!/bin/bash

# Copy the code used by generated packages.
rm -fr inst/src
mkdir -p inst/src
cp -r R/* inst/src

# Add a "do not edit" warning to the generated packages' code files.
for i in inst/src/*.R; do
  sed -i '1s/^/# This file is generated by make\.paws\. Please do not edit here\.\n\n/' $i;
done

# Make a list of the R packages used by the generated packages.
# Use a loop because Rtools for Windows does not have xargs.
imports=()
for file in $(find ./R ! -name "make*" -name "*.R"); do
  imports+=($(grep -hoP "[a-zA-Z0-9\.]+(?=::)" "$file"))
done
echo ${imports[@]} | tr " " "\n" | sort | uniq > inst/extdata/imports.csv
